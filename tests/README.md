# テストドキュメント

## 概要

日本語ベクトル検索システムの統合テストとエンドツーエンドテストの実装です。

## テスト構成

### 1. 統合テスト (`test_integration_simple.py`)

基本的な統合テストを実装しています。依存関係の問題を回避するため、シンプルな実装を使用しています。

**テスト内容:**
- エンドツーエンドワークフローテスト
- バッチ処理統合テスト
- 類似度検索統合テスト
- 基本パフォーマンステスト
- エラーハンドリングテスト

### 2. エンドツーエンドテスト (`test_end_to_end_scenarios.py`)

実際の使用シナリオに基づいたテストを実装しています。

**テストシナリオ:**
- 完全なワークフローシナリオ
- 増分処理シナリオ
- エラー回復シナリオ
- 大規模データセットシナリオ
- 設定ファイルシナリオ
- 実世界での使用パターン

### 3. テストデータ (`test_data/`)

テスト用のHTMLファイルを含んでいます：

- `sample_page_1.html` - 織田信長のサンプルページ
- `sample_page_2.html` - 豊臣秀吉のサンプルページ
- `sample_page_3.html` - 徳川家康のサンプルページ
- `empty_page.html` - 空のページ（エラーハンドリング用）
- `large_page.html` - 大規模コンテンツページ（パフォーマンステスト用）
- `invalid_encoding.html` - エンコーディングテスト用

## テスト実行方法

### 統合テストのみ実行

```bash
python tests/test_integration_simple.py
```

### 全テスト実行

```bash
python tests/run_all_tests.py
```

### 個別テスト実行

```bash
python -m unittest tests.test_integration_simple -v
```

## テスト要件

### 必須依存関係

- Python 3.7+
- numpy
- sqlite3 (標準ライブラリ)
- beautifulsoup4

### オプション依存関係

- sentence_transformers (利用できない場合はモックを使用)

## パフォーマンス要件

統合テストでは以下のパフォーマンス要件を検証しています：

- テキスト抽出: 1秒以内
- ベクトル化: 5秒以内（大規模ファイル）
- データベース保存: 0.1秒以内
- 全体処理: 10秒以内（大規模ファイル）
- バッチ処理: 1ファイルあたり平均2秒以内
- 類似度検索: 2秒以内（100ドキュメント）

## エラーシナリオ

以下のエラーシナリオをテストしています：

1. **ファイル関連エラー**
   - 存在しないファイル
   - 空のHTMLファイル
   - 無効なHTMLファイル

2. **データベースエラー**
   - 接続エラー
   - 存在しないキーの取得

3. **処理エラー**
   - 空テキストの処理
   - メモリ不足シナリオ

## テスト結果の確認

テスト実行後、以下のファイルが生成されます：

- `test_report.txt` - テスト実行レポート

## トラブルシューティング

### 依存関係エラー

sentence_transformersが利用できない場合、統合テストは自動的にモックを使用します。

### エンコーディングエラー

Windowsでの文字エンコーディング問題を回避するため、絵文字を使用しない設定になっています。

### タイムアウトエラー

大規模データセットのテストでタイムアウトが発生する場合は、テスト設定のタイムアウト値を調整してください。

## 継続的インテグレーション

このテストスイートは継続的インテグレーション環境での実行を想定して設計されています：

- 依存関係の自動検出
- エラー時の適切な終了コード
- 詳細なログ出力
- テストレポートの自動生成

## 今後の拡張

以下の拡張が可能です：

1. **カバレッジレポート**
   - コードカバレッジの測定と報告

2. **ベンチマークテスト**
   - より詳細なパフォーマンス測定

3. **ストレステスト**
   - 大量データでの負荷テスト

4. **セキュリティテスト**
   - 入力検証とセキュリティホールの検出