# 実装計画

- [x] 1. プロジェクト構造とコア依存関係の設定
  - プロジェクトディレクトリ構造を作成
  - requirements.txtファイルを作成（sentence-transformers, beautifulsoup4, numpy, sqlite3）
  - 基本的な設定ファイルとログ設定を実装
  - _要件: 1.1, 2.1_

- [x] 2. HTMLProcessor クラスの実装
  - HTMLファイルからテキストを抽出するメソッドを実装
  - 日本語エンコーディング処理を実装
  - ファイル名からキーを生成するメソッドを実装
  - コンテンツ長の検証機能を実装
  - HTMLProcessor の単体テストを作成
  - _要件: 1.1, 1.2, 1.4_

- [x] 3. VectorEmbedder クラスの実装
  - Sentence Transformersモデルの初期化を実装
  - 単一テキストのベクトル化メソッドを実装
  - バッチテキストのベクトル化メソッドを実装
  - メモリ効率的な処理を実装
  - VectorEmbedder の単体テストを作成
  - _要件: 1.3, 1.5_

- [x] 4. DatabaseManager クラスの実装
  - SQLiteデータベース接続とテーブル作成を実装
  - ベクトルデータの保存メソッドを実装
  - ベクトルデータの取得メソッドを実装
  - 既存レコードの更新機能を実装
  - データベース接続エラーハンドリングを実装
  - DatabaseManager の単体テストを作成
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 5. SimilarityCalculator クラスの実装
  - コサイン類似度計算メソッドを実装
  - 類似ドキュメント検索メソッドを実装
  - エッジケース処理（ゼロベクトル等）を実装
  - パフォーマンス最適化を実装
  - SimilarityCalculator の単体テストを作成
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 6. BatchProcessor クラスの実装
  - HTMLファイル自動発見機能を実装
  - プログレス表示機能を実装
  - エラー処理と継続機能を実装
  - 処理済みファイルのスキップ機能を実装
  - 処理結果サマリー機能を実装
  - BatchProcessor の単体テストを作成
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 7. QueryEngine クラスの実装
  - テキストクエリのベクトル化と検索を実装
  - ドキュメントキーによる類似検索を実装
  - 設定可能な結果数制限を実装
  - 閾値による結果フィルタリングを実装
  - データベース接続エラーハンドリングを実装
  - QueryEngine の単体テストを作成
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_
-

- [x] 8. メインスクリプトとCLIインターフェースの実装
  - バッチ処理用のメインスクリプトを作成
  - コマンドライン引数処理を実装
  - 設定ファイル読み込み機能を実装
  - ログ出力設定を実装
  - CLIインターフェースのテストを作成
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 9. 検索用CLIツールの実装



  - テキストクエリ検索コマンドを実装
  - ドキュメント類似検索コマンドを実装
  - 結果表示フォーマットを実装
  - インタラクティブモードを実装
  - 検索CLIのテストを作成
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 10. 統合テストとエンドツーエンドテストの実装





  - 全体フローの統合テストを作成
  - 実際のHTMLファイルを使用したテストを実装
  - パフォーマンステストを実装
  - エラーシナリオのテストを実装
  - テストデータセットを準備
  - _要件: 1.1-1.5, 2.1-2.5, 3.1-3.5, 4.1-4.5, 5.1-5.5_

- [x] 11. ドキュメントとサンプルの作成
  - README.mdファイルを作成（使用方法、インストール手順）
  - APIドキュメントを作成
  - 使用例とサンプルコードを作成
  - トラブルシューティングガイドを作成
  - _要件: 全要件の使用方法説明_

- [ ] 12. 日本語歴史コンテンツ向けベクトル化改善




  - 日本語専用モデル（sonoisa/sentence-bert-base-ja-mean-tokens-v2）の統合
  - マルチモデルアンサンブル機能の実装
  - 日本語テキスト前処理の強化（歴史人物名正規化）
  - 固有名詞抽出機能の実装
  - _要件: 6.1, 6.3, 6.5_

- [ ] 13. 重み付き類似度計算システムの実装
  - EnhancedSimilarityCalculatorクラスの作成
  - 固有名詞マッチングボーナス計算の実装
  - 歴史的関連性ボーナス計算の実装
  - 重み付きスコア統合機能の実装
  - _要件: 6.2, 6.4, 6.5_

- [ ] 14. 歴史人物関連性データベースの構築
  - 歴史人物関係性マッピングデータの作成
  - 関連性スコア計算ロジックの実装
  - 動的関連性学習機能の実装
  - 関連性データの永続化機能の実装
  - _要件: 6.1, 6.2, 6.4_

- [ ] 15. 検索結果品質評価システムの実装
  - 歴史人物検索テストケースの作成
  - 検索結果品質メトリクスの実装
  - A/Bテスト機能の実装（旧システムとの比較）
  - 検索結果の可視化機能の実装
  - _要件: 6.1, 6.2, 6.4_

- [ ] 16. 統合テストと性能評価
  - 「織田信長」検索での関連人物高スコア化テスト
  - 複数歴史人物での検索品質テスト
  - 改善前後の性能比較テスト
  - メモリ使用量とレスポンス時間の測定
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_